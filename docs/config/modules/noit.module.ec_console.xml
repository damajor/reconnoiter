<?xml version="1.0"?>
<section xmlns="http://docbook.org/ns/docbook" version="5">
  <title>ec_console</title>
  <para>Run an ec_console command, parse its results and return them</para>
  <variablelist>
    <varlistentry>
      <term>loader</term>
      <listitem>
        <para>lua</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>object</term>
      <listitem>
        <para>noit.module.ec_console</para>
      </listitem>
    </varlistentry>
  </variablelist>
  <section>
    <title>Check Configuration</title>
    <variablelist>
      <varlistentry>
        <term>port</term>
        <listitem>
          <variablelist>
            <varlistentry>
              <term>required</term>
              <listitem>
                <para>optional</para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>default</term>
              <listitem>
                <para>2025</para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>allowed</term>
              <listitem>
                <para>\d+</para>
              </listitem>
            </varlistentry>
          </variablelist>
          <para>Specifies the TCP port to connect to.</para>
        </listitem>
      </varlistentry>
    </variablelist>
    <variablelist>
      <varlistentry>
        <term>command</term>
        <listitem>
          <variablelist>
            <varlistentry>
              <term>required</term>
              <listitem>
                <para>optional</para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>default</term>
              <listitem>
                <para>xml summary</para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>allowed</term>
              <listitem>
                <para>.+</para>
              </listitem>
            </varlistentry>
          </variablelist>
          <para>Specifies the ec_console command to run (must produce XML output).</para>
        </listitem>
      </varlistentry>
    </variablelist>
    <variablelist>
      <varlistentry>
        <term>xpath</term>
        <listitem>
          <variablelist>
            <varlistentry>
              <term>required</term>
              <listitem>
                <para>optional</para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>default</term>
              <listitem>
                <para>/ServerSummary/*</para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>allowed</term>
              <listitem>
                <para>.+</para>
              </listitem>
            </varlistentry>
          </variablelist>
          <para>xpath to fetch objects from, should also include a trailing wildcard when requesting all objects (if the objects option is not defined)</para>
        </listitem>
      </varlistentry>
    </variablelist>
    <variablelist>
      <varlistentry>
        <term>objects</term>
        <listitem>
          <variablelist>
            <varlistentry>
              <term>required</term>
              <listitem>
                <para>optional</para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>default</term>
              <listitem>
                <para/>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>allowed</term>
              <listitem>
                <para>.*</para>
              </listitem>
            </varlistentry>
          </variablelist>
          <para>Objects to fetch from the xpath, comma-separated list.  If missing all objects will be fetched</para>
        </listitem>
      </varlistentry>
    </variablelist>
    <variablelist>
      <varlistentry>
        <term>sasl_authentication</term>
        <listitem>
          <variablelist>
            <varlistentry>
              <term>required</term>
              <listitem>
                <para>optional</para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>default</term>
              <listitem>
                <para>off</para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>allowed</term>
              <listitem>
                <para>(?:off|digest-md5)</para>
              </listitem>
            </varlistentry>
          </variablelist>
          <para>Specifies the type of SASL Authentication to use</para>
        </listitem>
      </varlistentry>
    </variablelist>
    <variablelist>
      <varlistentry>
        <term>sasl_user</term>
        <listitem>
          <variablelist>
            <varlistentry>
              <term>required</term>
              <listitem>
                <para>optional</para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>default</term>
              <listitem>
                <para/>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>allowed</term>
              <listitem>
                <para>.+</para>
              </listitem>
            </varlistentry>
          </variablelist>
          <para>The SASL Authentication username</para>
        </listitem>
      </varlistentry>
    </variablelist>
    <variablelist>
      <varlistentry>
        <term>sasl_password</term>
        <listitem>
          <variablelist>
            <varlistentry>
              <term>required</term>
              <listitem>
                <para>optional</para>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>default</term>
              <listitem>
                <para/>
              </listitem>
            </varlistentry>
            <varlistentry>
              <term>allowed</term>
              <listitem>
                <para>.+</para>
              </listitem>
            </varlistentry>
          </variablelist>
          <para>The SASL Authentication password</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>
  <section>
    <title>Examples</title>
    <example>
      <title>Read the summary command</title>
      <para>The following example to connect to 10.0.0.1 and read the summary command</para>
      <programlisting>
      &lt;noit&gt;
        &lt;modules&gt;
          &lt;loader image="lua" name="lua"&gt;
            &lt;config&gt;&lt;directory&gt;/opt/reconnoiter/libexec/modules-lua/?.lua&lt;/directory&gt;&lt;/config&gt;
          &lt;/loader&gt;
          &lt;module loader="lua" name="smtp" object="noit.module.ec_console"/&gt;
        &lt;/modules&gt;
        &lt;checks&gt;
          &lt;check uuid="2d42adbc-7c7a-11dd-a48f-4f59e0b654d3" module="ec_console" target="10.0.0.1"&gt;
            &lt;config&gt;
              &lt;command&gt;xml summary&lt;/command&gt;
              &lt;xpath&gt;/ServerSummary/*&lt;/xpath&gt;
              &lt;sasl_authentication&gt;digest-md5&lt;/sasl_authentication&gt;
              &lt;sasl_user&gt;admin&lt;/sasl_user&gt;
              &lt;sasl_password&gt;admin&lt;/sasl_password&gt;
            &lt;/config&gt;
          &lt;/check&gt;
        &lt;/checks&gt;
      &lt;/noit&gt;
      </programlisting>
    </example>
  </section>
</section>
